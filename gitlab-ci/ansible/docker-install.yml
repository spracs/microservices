---
- name: Install Docker
  hosts: gcp_ansible_gitlab
  become: true
  tasks:
  - name: Add keys for docker install
    apt_key:
      url: https://download.docker.com/linux/ubuntu/gpg
      state: present
  - name: Add docker repo
    apt_repository:
      repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable
      state: present
  - name: Install docker & pip
    apt: "name={{ item }} state=present update_cache=yes"
    with_items:
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - python-pip
  - name: Upgrade pip
    pip: 
      name: pip
      extra_args: --upgrade
  - name: Install Docker Module for Python
    pip: "name={{ item }}"
    with_items:
      - docker
      - docker-compose
  - name: Add startup scripts
    systemd: name=docker enabled=yes state=started
